<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width, user-scalable=no"/>
    <title> fridgE </title>
    <style>
	
	.selected {color: green;}
	.popup {
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
            display: none;
        }
        .popup-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888888;
            width: 30%;
            font-weight: bolder;
        }
        .popup-content button {
            display: block;
            margin: 0 auto;
        }
	.popup-recipe {
	    background-color: white;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888888;
            width: 50%;
            font-weight: bolder;
	}
        .show {
            display: block;
        }
	body {
	    background-color: white;
	    font-family: Garamond, serif;
	}
        h1 {
            color: #4e823b;
        }
	#block {
            width = 100%;
	    max-height=550px;
	}
	#back{
	   right: 15px;
	   width: 50px;
	}
	#fridge{
	   display: inline-block;
	   width: 40%;
	}
	#pantry{ 
	   display: inline-block;
	   width: 40%;
	   margin-left: 10%;
	}

	#head { 
            white-space: nowrap;
	    display: inline-block;
	    width: 100%;
	    height: 50px;
	}
	header{
	    display: inline-block;
	    color: #4e823b;
	    font-weight: bolder;
	}
	#addIngredient{
	    display: inline-block;
	    margin-left: 50px;
	}
	#selected{
	    height = 0px;
	}
	button{
	    background-color: #4e823b;	
	    color: white;
	    width: 100%;
            height: 100%;
	    border-radius: 12px;
	}
	html{ height: 100%; }
	body{ min-height: 90%;}
	#foot{margin-bottom: 50px;}
	#list{margin-left:10%; min-width:550px; min-height: 550px; max-height: 550px; overflow-y: scroll; overflow-x:scroll; background-color: #d1ffbf; color: black;}
	.item{margin: 5px; height: 50px; display:inline-block;}
	.ibutton{margin: 3px; height: 25px; width: 25px; display:inline-block;}
	#amount{min-width: 100px; max-height: 50px; display:inline-block;}
    </style>
</head>

<body>
    <!-- Home page -->
    <div id="block">
        <div id="fridge">
            <div id="head">
	        <header>Fridge</header>
	        <button id="addIngredient" onclick="addIngredient(document.getElementById('fridge'));">Add Ingredient</button> 	
            </div>
	    <div id="list">
	    	<ul id="fridge_ul" onload="initList(document.getElementById('fridge'));">
			<li>
				<div id="name" class="item">radish</div><div id="date" class="item">2/18/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">5</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>
			<li>
				<div id="name" class="item">cheddar</div><div id="date" class="item">2/10/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">1</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>	
			<li>
				<div id="name" class="item">celery</div><div id="date" class="item">2/18/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">2</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>
			<li>
				<div id="name" class="item">pork belly</div><div id="date" class="item">2/25/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">2 lbs</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>
			<li>
				<div id="name" class="item">ginger</div><div id="date" class="item">2/10/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">3</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>
			<li>
				<div id="name" class="item">collard greens</div><div id="date" class="item">2/18/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">3 bunches</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>
			<li>
				<div id="name" class="item">butter</div><div id="date" class="item">2/10/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">4 sticks</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>	
			<li>
				<div id="name" class="item">carrots</div><div id="date" class="item">2/10/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">12</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>	
			<li>
				<div id="name" class="item">salami</div><div id="date" class="item">2/18/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">1</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>	
			<li>
				<div id="name" class="item">roast beef</div><div id="date" class="item">2/18/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">1</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>	
		</ul> 	
	    </div>
        </div>
        <div id="pantry">
            <div id="head">
	        <header>Pantry</header>
	        <button id="addIngredient" onclick="addIngredient(document.getElementById('pantry'));">Add Ingredient</button> 	
            </div>
	    <div id="list">
		<ul id="pantry_ul" onload="initList(document.getElementById('pantry'));">
			<li>
				<div id="name" class="item">rice</div><div id="date" class="item">10/10/23</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item"></p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>
			<li>
				<div id="name" class="item">sugar</div><div id="date" class="item">10/10/23</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">5 cups</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>
			<li>
				<div id="name" class="item">potatoes</div><div id="date" class="item">1/30/24</div><div id="amount"><button id="-" class="ibutton" onclick="minus(this.parentElement.children.value)">-</button><p id="value" class="item">10</p><button id="+" class="ibutton" onclick="plus(this.parentElement.children.value)">+</button><button id="o" class="ibutton" onclick="select(this)">o</button></div>
			</li>
		</ul> 
	    </div>
        </div>
    </div>
    <div id="foot">
	<div id="selected" visibility="hidden">
	    <ul id="fridge" visibility="hidden"></ul>
	    <ul id="pantry"></ul>
	</div>
	<button id="remove" onClick="removeIngredients(document.getElementById('foot').children[0])">Remove</button>
	<button id="search" onClick="searchIngredients(document.getElementById('foot').children[0])">Search Recipe</button>
    </div>

    <!-- Add Ingredient Popup -->
    <div id="myPopup" class="popup">
	<div class="popup-content">
	    <h1 style="color:green;">
		Add Ingredient
	    </h1>
	    <form method="post" id="addForm" onsubmit="return add(document.getElementById('addForm'));">             
		<label for="name">Ingredient Name:</label>
		<div class="error" id="name-error">Name is a required field.</div>
		<input type="text" name="name" id="name">	    	

		<label for="date">Date:</label>
		<input type="text" name="date" id="date">

		<label for="amount">Amount:</label>
		<input type="text" name="amount" id="amount">

		<input type="submit" value="Add">  
		<div class="back" onclick="closeAddIngredient();">Back</div>
	    </form> 
	</div> 
    </div>
    
    <!-- Search Recipe Popup -->
    <div id="recipePopup" class="popup">
	<div class="popup-content">
	    <button id="back" onclick="closeSearch()">Back</button>
	    <h1 style="color:green;">
		Recipes Containing:
	    </h1>
	    <p id="selected_ingredients">
	    </p>
	    <ul id="recipes">
		<li class="recipe">
			<h1>Radish Soup</h1>
			<p>Ingredients: 5 Radishes, 1/2 cup Celery, 1 Onion, Chicken Broth</p>
		</li>
		<li class="recipe">
			<h1>Radish Salad</h1>
			<p>Ingredients: 5 Radishes, 1/2 Iceberg Lettuce, 2 Carrots, 1 tbsp Baslamic Vinegar, 1 tsp Honey</p>
		</li>
		<li class="recipe">
			<h1>Roasted Roots</h1>
			<p>Ingredients: 3 Potatoes, 3 Carrots, 2 Turnips, 3 Radishes</p>
		</li>
		<li class="recipe">
			<h1>Whole Raw Radish</h1>
			<p>Ingredients: 1 Radish</p>
		</li>
	    </ul>
	</div> 
    </div>
    <script>
	function searchIngredients(list)
	{
	    document.getElementById("recipePopup").classList.add("show");
	    loadSelected(); 
	}
	function closeSearch()
	{
	    document.getElementById("recipePopup").classList.remove("show");
	    list = document.getElementById("selected_ingredients");
	    list.innerHTML = "";
	}
	function loadSelected()
	{
	    list = document.getElementById("selected_ingredients");
	    fridge = document.getElementById("fridge_ul").children;
	    pantry = document.getElementById("pantry_ul").children;

	    for(var i = 0; i < fridge.length; i++)
		if(fridge[i].children[2].children[3].classList.contains("selected"))
			list.innerHTML = list.innerHTML + fridge[i].children[0].innerHTML + ', ';

	    for(var i = 0; i < pantry.length; i++)
		if(pantry[i].children[2].children[3].classList.contains("selected"))
			list.innerHTML = list.innerHTML + pantry[i].children[0].innerHTML + ', ';

	    if(list.innerHTML.length>0)
		list.innerHTML = list.innerHTML.substring(0, list.innerHTML.length-2);
	}   
	function initList(element)
	{
	    const fs = require('fs');
	    const readline = require('readline');
	    
	    const readStream = fs.createReadStream(element.id + ".txt", 
		function(err) {if(err) {alert("Cannot read " + element.id + ".txt");}});
	    const readInterface = readline.createInterface({
		input: readStream,
		output: process.stdout,
		console: false});

	    var list = element.children.list.children[0];
	    readInterface.on('line', function(line){
	    	var ingredient = document.createElement("li", {id: "ingredient"});
	    	
		var name = line.substring(0, line.indexOf(","));
		line = line.substring(line.indexOf(",") + 1, line.length);
		var date = line.substring(0, line.indexOf(","));
		var amount = line.substring(line.indexOf(",") + 1, line.length);			    	

		var contents = '<div id="name">' + name + '</div><div id="date">' + date + '</div><div id="amount"><button id="-" onclick="minus(amount.children.value);">-</button><p id="value">' + amount + '</p><button id="+" onclick="plus(amount.children.value)">+</button><button id="o" onclick="select(this)">o</button></div>';

		ingredient.innerHTML = contents;
	        list.appendChild(ingredient);
	    });
	}
	function addIngredient(element)
	{
	    document.getElementById("myPopup").classList.add(element.id);
	    document.getElementById("myPopup").classList.add("show");
	}
	function closeAddIngredient()
	{
	    document.getElementById("myPopup").classList.remove("show");
	    document.getElementById("myPopup").classList.remove(myPopup.classList[1]);
	}
	function add(form)
	{
	    var list = document.getElementById(document.getElementById("myPopup").classList[1]).children.namedItem("list").children[0];
	    var ingredient = document.createElement("li", {id: "ingredient"});

	    var name = document.createElement("div", {id: "ingredient"});
		name.id = "ingredient";
		name.classList.add("item");
	        name.innerHTML = form.name.value;
	
	    var date = document.createElement("div", {id: "date"});
		date.id = "date";
		date.classList.add("item");
		date.innerHTML = form.date.value;

	    var amount = document.createElement("div", {id: "amount"});
		amount.id = "amount";
	    var minus = document.createElement("button", {id: "-"});
		minus.id = '-';
		minus.classList.add('ibutton');
		minus.onclick = "minus(this.parentElement.children.value)";
		minus.innerHTML = "-";
	    var value = document.createElement("p", {id: "value"});
		value.id = 'value';
		value.classList.add('item');
		value.innerHTML = form.amount.value;
	    var plus = document.createElement("button", {id: "+"});
		plus.id = '+';
		plus.classList.add('ibutton');
		plus.onclick = "plus(this.parentElement.children.value)";
		plus.innerHTML = "+";
	    var select = document.createElement("button", {id: "o"});
		select.id = 'o';
		select.classList.add('ibutton');
		select.onclick="select(this)";
		select.innerHTML = "o";

		amount.appendChild(minus);
		amount.appendChild(value);
		amount.appendChild(plus);
		amount.appendChild(select);

		ingredient.appendChild(name);
		ingredient.appendChild(date);
		ingredient.appendChild(amount);
	
	    	list.appendChild(ingredient);

	    //var fs = require('fs');
	    //fs.appendFile(document.getElementById("myPopup").classList.get(1) + ".txt", form.name + "," + form.date + "," + form.amount, function(err) {if(err) {alert("Error adding " + form.name);}});

	    closeAddIngredient();	
	    return false;
	}
	function plus(value)
	{
	    var val = value.innerHTML;
	    val = val.replace(/[0-9]*/,parseInt(val.replace(/\D/g, ""))+ 1);
	    value.innerHTML = val;
	}
	function minus(value)
	{
	    var val = value.innerHTML;
	    val = val.replace(/[0-9]*/,parseInt(val.replace(/\D/g, ""))- 1);
	    value.innerHTML = val;
	}	
	function select(ingredient)
	{
	    if(!ingredient.classList.contains("selected"))
		ingredient.classList.add("selected");
	    else
		ingredient.classList.remove("selected");
	    //ingredient.classList.add("selected");
	    /*
	    var selected = document.getElementById("foot").children[0].children.namedItem(ingredient.parentElement.parentElement.parentElement.id);
	    if(selected == null || !contains(selected, ingredient))
	    {
	    	selected.appendChild(ingredient);
		ingredient.lastChild.lastChild.classList.add("selected");
	    }
	    else
	    {
	        selected.removeChild(ingredient);
		ingredient.lastChild.lastChild.classList.remove("selected");
	    }
	    */
	}
	function removeIngredients(list)
	{
	    remove(list.children[0]);
	    remove(list.children[1]);
	}
	function remove(removelist)
	{
	    var list = document.getElementById(removelist.id).children.namedItem("list").children[0];
	    for(let i = 0; i < list.children.length; i++)
	    {
		if(contains(removelist, list.children[i]))
		{
		    list.removeChild(list.children[i]);
		}
	    }
	}
	function contains(list, item)
	{
	    const name = item.children[0].innerHTML;
	    for(let i = 0; i < list.children.length; i++)
	    {
		if(name.equals(list.children[i].children[0].innerHTML))
		{
		    return true;
		}
	    }
	    return false;
	}
    </script>
</body>
</html>